#nginx ssl proxy configuration parameters (extending config generated with docker-gen)
server_tokens off;
proxy_buffering off;
client_max_body_size {{ getenv "MAX_UPLOAD_SIZE" "16G" }};

#set_real_ip_from  172.17.0.0/16;
real_ip_header    X-Forwarded-For;

proxy_set_header        X-Real-IP       $remote_addr;
proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;

location ~ \.(?:css|js|woff|svg|gif|png|html|ttf|ico|jpg|jpeg)$ {
  access_log off;
  proxy_pass http://{{ getenv "PUBLIC_FQDN" }};
}
#location ~ ^/ping$ {
#  access_log off;
#	add_header Content-Type text/plain;
#	return 200 'pong';
#}
location ~ ^/(status|ping|phpinfo.php)$ {
  limit_rate 8;
  limit_conn addr 1;
  limit_conn_status 429;
  return 418;
}
error_page 418 429 500 502 503 504 @error;

location @error {
  add_header Retry-After 120 always;
  internal;
  root /usr/share/nginx/html;
  try_files $uri /error.html /50x.html;
}

location /get_error {
    return 500;
}
